<!-- PWA Installation Guide -->
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0 rounded-lg">
        <div class="card-header bg-primary text-white">
          <h2 class="mb-0"><i class="bi bi-download me-2"></i>Install Our App</h2>
        </div>
        <div class="card-body p-5">
          <div class="text-center mb-5">
            <img src="/img/icon-192x192.png" alt="App Icon" class="img-fluid" style="max-width: 150px;">
            <h3 class="mt-3">QR Code Verification System</h3>
            <p class="lead">Install our app for a better experience!</p>
          </div>
          
          <div class="alert alert-info">
            <i class="bi bi-info-circle-fill me-2"></i>
            Installing this app will allow you to:
            <ul class="mt-2 mb-0">
              <li>Use it offline</li>
              <li>Access it directly from your home screen</li>
              <li>Get a more app-like experience</li>
              <li>Verify products faster</li>
            </ul>
          </div>
          
          <h4 class="mt-5 mb-4">Installation Instructions</h4>
          
          <div class="accordion" id="installInstructions">
            <!-- Chrome on Android -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#chromeAndroid">
                  <i class="bi bi-android2 me-2"></i>Chrome on Android
                </button>
              </h2>
              <div id="chromeAndroid" class="accordion-collapse collapse show" data-bs-parent="#installInstructions">
                <div class="accordion-body">
                  <ol>
                    <li>Tap the "Install App" button at the bottom of the screen</li>
                    <li>Or tap the menu button (three dots) in the top right corner</li>
                    <li>Select "Install App" or "Add to Home Screen"</li>
                    <li>Confirm by tapping "Install"</li>
                  </ol>
                </div>
              </div>
            </div>
            
            <!-- Safari on iOS -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#safariIOS">
                  <i class="bi bi-apple me-2"></i>Safari on iOS
                </button>
              </h2>
              <div id="safariIOS" class="accordion-collapse collapse" data-bs-parent="#installInstructions">
                <div class="accordion-body">
                  <ol>
                    <li>Tap the share button (rectangle with arrow) at the bottom of the screen</li>
                    <li>Scroll down and tap "Add to Home Screen"</li>
                    <li>Enter a name for the app or use the suggested name</li>
                    <li>Tap "Add" in the top right corner</li>
                  </ol>
                </div>
              </div>
            </div>
            
            <!-- Chrome on Desktop -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#chromeDesktop">
                  <i class="bi bi-laptop me-2"></i>Chrome on Desktop
                </button>
              </h2>
              <div id="chromeDesktop" class="accordion-collapse collapse" data-bs-parent="#installInstructions">
                <div class="accordion-body">
                  <ol>
                    <li>Click the "Install App" button at the bottom right of the screen</li>
                    <li>Or click the install icon (computer with down arrow) in the address bar</li>
                    <li>Click "Install" in the prompt that appears</li>
                  </ol>
                </div>
              </div>
            </div>
            
            <!-- Edge on Desktop -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#edgeDesktop">
                  <i class="bi bi-microsoft me-2"></i>Edge on Desktop
                </button>
              </h2>
              <div id="edgeDesktop" class="accordion-collapse collapse" data-bs-parent="#installInstructions">
                <div class="accordion-body">
                  <ol>
                    <li>Click the "..." menu in the top right corner</li>
                    <li>Select "Apps" from the menu</li>
                    <li>Click "Install this site as an app"</li>
                    <li>Confirm by clicking "Install"</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
          
          <div class="text-center mt-5">
            <button id="install-guide-btn" class="btn btn-primary btn-lg">
              <i class="bi bi-download me-2"></i>Install Now
            </button>
            <p class="text-muted mt-3">
              <small>If the button doesn't work, follow the manual instructions above for your device.</small>
            </p>
            
            <!-- Direct install buttons for different browsers -->
            <div class="mt-4">
              <p><strong>Or try these direct install options:</strong></p>
              <div class="d-flex flex-wrap justify-content-center gap-2">
                <button onclick="window.location.href='https://support.google.com/chrome/answer/9658361'" class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-google me-1"></i>Chrome
                </button>
                <button onclick="window.location.href='https://support.apple.com/guide/safari/bookmark-favorite-webpages-ibrw1039/mac'" class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-apple me-1"></i>Safari
                </button>
                <button onclick="window.location.href='https://support.microsoft.com/en-us/microsoft-edge/add-a-website-to-apps-in-microsoft-edge-0c8bfde3-ba0e-4b61-a1ea-eac8b969ee6d'" class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-microsoft me-1"></i>Edge
                </button>
                <button onclick="window.location.href='https://support.mozilla.org/en-US/kb/add-web-page-shortcuts-your-home-screen'" class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-firefox me-1"></i>Firefox
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Store the installation prompt
  let installPrompt = null;
  
  // Listen for the beforeinstallprompt event
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    installPrompt = e;
    console.log('Install prompt captured on guide page');
    
    // Enable the install button
    const installBtn = document.getElementById('install-guide-btn');
    if (installBtn) {
      installBtn.disabled = false;
    }
  });
  
  document.addEventListener('DOMContentLoaded', function() {
    // Show the appropriate installation instructions based on the user's device
    function showRelevantInstructions() {
      const userAgent = navigator.userAgent;
      
      if (/iPhone|iPad|iPod/.test(userAgent)) {
        // iOS - show Safari instructions
        document.querySelector('button[data-bs-target="#safariIOS"]').click();
      } else if (/Android/.test(userAgent)) {
        // Android - show Chrome instructions
        document.querySelector('button[data-bs-target="#chromeAndroid"]').click();
      } else if (/Edg/.test(userAgent)) {
        // Edge - show Edge instructions
        document.querySelector('button[data-bs-target="#edgeDesktop"]').click();
      } else {
        // Default to Chrome desktop
        document.querySelector('button[data-bs-target="#chromeDesktop"]').click();
      }
    }
    
    // Show the relevant instructions when the page loads
    showRelevantInstructions();
    
    // Set up the install button
    const installBtn = document.getElementById('install-guide-btn');
    if (installBtn) {
      installBtn.addEventListener('click', function() {
        // Try to use the stored prompt first
        if (installPrompt) {
          console.log('Using locally stored prompt');
          installPrompt.prompt();
          
          installPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('User accepted the installation');
              installBtn.disabled = true;
              installBtn.textContent = 'Installed!';
            }
            installPrompt = null;
          });
        } 
        // Fall back to the global prompt
        else if (window.deferredPrompt) {
          console.log('Using global prompt');
          window.deferredPrompt.prompt();
          
          window.deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('User accepted the installation');
              installBtn.disabled = true;
              installBtn.textContent = 'Installed!';
            }
            window.deferredPrompt = null;
          });
        } 
        // No prompt available, show instructions
        else {
          console.log('No installation prompt available, showing manual instructions');
          showRelevantInstructions();
        }
      });
    }
    
    // Log installation status for debugging
    console.log('Installation guide page loaded');
    console.log('Local prompt available:', !!installPrompt);
    console.log('Global prompt available:', !!window.deferredPrompt);
  });
</script>